import React from 'react';
import {connect} from 'react-redux';

import { Input, Select } from 'antd';
import Flag from "react-world-flags";
import _ from 'lodash'
import InputMask from 'react-input-mask'
import {getCountries} from "../Redux/Actions/countriesActions";

const { Option } = Select;
const InputGroup = Input.Group;

const defaultCountry = {
    "id":"unknown",
    "code":"UNKNWN",
    "name":"НЕИЗВЕСТНО",
    "phoneInfo":{
        "prefix":"+",
        "minLength":12,
        "maxLength":12,
        "format":"+000000000000"
    }};

class PhoneInput extends React.Component {
    constructor(props, context) {
        super(props, context);

        this.state = {
            countries: [{"id":"UZB","code":"UZ","name":"УЗБЕКИСТАН","phoneInfo":{"prefix":"+998","minLength":9,"maxLength":9,"format":"+000 00 000 00 00"}},{"id":"TJK","code":"TJ","name":"ТАДЖИКИСТАН","phoneInfo":{"prefix":"+992","minLength":9,"maxLength":9,"format":"+000 000 00 0000"}},{"id":"KGZ","code":"KG","name":"КЫРГЫЗСТАН","phoneInfo":{"prefix":"+996","minLength":9,"maxLength":9,"format":"+000 000 000 000"}},{"id":"TUR","code":"TR","name":"ТУРЦИЯ","phoneInfo":{"prefix":"+90","minLength":10,"maxLength":10,"format":"+00 000 000 0000"}},{"id":"MDA","code":"MD","name":"МОЛДОВА","phoneInfo":{"prefix":"+373","minLength":8,"maxLength":8,"format":"+000 000 00 000"}},{"id":"AZE","code":"AZ","name":"АЗЕРБАЙДЖАН","phoneInfo":{"prefix":"+994","minLength":8,"maxLength":9,"format":"+000 00 000 00 00"}},{"id":"RUS","code":"RU","name":"РОССИЯ","phoneInfo":{"prefix":"+7","minLength":10,"maxLength":10,"format":"+0 000 000-00-00"}},{"id":"KAZ","code":"KZ","name":"КАЗАХСТАН","phoneInfo":{"prefix":"+7","extendedPrefix":"600-799","minLength":10,"maxLength":10,"format":"+0 000 000-00-00"}},{"id":"GEO","code":"GE","name":"ГРУЗИЯ","phoneInfo":{"prefix":"+995","minLength":9,"maxLength":9,"format":"+000 000 00 00 00"}},{"id":"BLR","code":"BY","name":"БЕЛАРУСЬ","phoneInfo":{"prefix":"+375","minLength":9,"maxLength":9,"format":"+000 00 000 0000"}},{"id":"AUS","code":"AU","name":"АВСТРАЛИЯ","phoneInfo":{"prefix":"+61","minLength":9,"maxLength":9,"format":"+00 000 000 000"}},{"id":"AUT","code":"AT","name":"АВСТРИЯ","phoneInfo":{"prefix":"+43","minLength":5,"maxLength":10,"format":"+00 000 000000"}},{"id":"ALA","code":"AX","name":"АЛАНДСКИЕ ОСТРОВА"},{"id":"ALB","code":"AL","name":"АЛБАНИЯ","phoneInfo":{"prefix":"+355","minLength":9,"maxLength":9,"format":"+000 00 000 0000"}},{"id":"DZA","code":"DZ","name":"АЛЖИР","phoneInfo":{"prefix":"+213","minLength":9,"maxLength":9,"format":"+000 000 00 00 00"}},{"id":"VIR","code":"VI","name":"АМЕРИКАНСКИЕ ВИРГИНСКИЕ ОСТРОВА","phoneInfo":{"prefix":"+1","extendedPrefix":"340","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"ASM","code":"AS","name":"АМЕРИКАНСКОЕ САМОА","phoneInfo":{"prefix":"+1","extendedPrefix":"684","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"AIA","code":"AI","name":"АНГИЛЬЯ","phoneInfo":{"prefix":"+1","extendedPrefix":"264","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"AGO","code":"AO","name":"АНГОЛА","phoneInfo":{"prefix":"+244","minLength":9,"maxLength":9,"format":"+000 000 000 000"}},{"id":"AND","code":"AD","name":"АНДОРРА","phoneInfo":{"prefix":"+376","minLength":6,"maxLength":6,"format":"+000 000 000"}},{"id":"ATA","code":"AQ","name":"АНТАРКТИДА"},{"id":"ATG","code":"AG","name":"АНТИГУА И БАРБУДА","phoneInfo":{"prefix":"+1","extendedPrefix":"268","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"ARG","code":"AR","name":"АРГЕНТИНА","phoneInfo":{"prefix":"+54","minLength":11,"maxLength":11,"format":"+00 0 00 0000-0000"}},{"id":"ARM","code":"AM","name":"АРМЕНИЯ","phoneInfo":{"prefix":"+374","minLength":8,"maxLength":8,"format":"+000 00 000000"}},{"id":"ABW","code":"AW","name":"АРУБА","phoneInfo":{"prefix":"+297","minLength":7,"maxLength":7,"format":"+000 000 0000"}},{"id":"AFG","code":"AF","name":"АФГАНИСТАН","phoneInfo":{"prefix":"+93","minLength":9,"maxLength":9,"format":"+00 00 000 0000"}},{"id":"BHS","code":"BS","name":"БАГАМСКИЕ ОСТРОВА","phoneInfo":{"prefix":"+1","extendedPrefix":"242","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"BGD","code":"BD","name":"БАНГЛАДЕШ","phoneInfo":{"prefix":"+880","minLength":10,"maxLength":10,"format":"+000 0000 000000"}},{"id":"BRB","code":"BB","name":"БАРБАДОС","phoneInfo":{"prefix":"+1","extendedPrefix":"246","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"BHR","code":"BH","name":"БАХРЕЙН","phoneInfo":{"prefix":"+973","minLength":8,"maxLength":8,"format":"+000 0000 0000"}},{"id":"BLZ","code":"BZ","name":"БЕЛИЗ","phoneInfo":{"prefix":"+501","minLength":7,"maxLength":7,"format":"+000 000-0000"}},{"id":"BEL","code":"BE","name":"БЕЛЬГИЯ","phoneInfo":{"prefix":"+32","minLength":9,"maxLength":9,"format":"+00 000 00 00 00"}},{"id":"BEN","code":"BJ","name":"БЕНИН","phoneInfo":{"prefix":"+229","minLength":8,"maxLength":8,"format":"+000 00 00 00 00"}},{"id":"BMU","code":"BM","name":"БЕРМУДСКИЕ ОСТРОВА","phoneInfo":{"prefix":"+1","extendedPrefix":"441","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"BGR","code":"BG","name":"БОЛГАРИЯ","phoneInfo":{"prefix":"+359","minLength":8,"maxLength":9,"format":"+000 00 000 0000"}},{"id":"BOL","code":"BO","name":"БОЛИВИЯ","phoneInfo":{"prefix":"+591","minLength":8,"maxLength":8,"format":"+000 00000000"}},{"id":"BIH","code":"BA","name":"БОСНИЯ И ГЕРЦЕГОВИНА","phoneInfo":{"prefix":"+387","minLength":8,"maxLength":8,"format":"+000 00 000 000"}},{"id":"BWA","code":"BW","name":"БОТСВАНА","phoneInfo":{"prefix":"+267","minLength":8,"maxLength":8,"format":"+000 00 000 000"}},{"id":"BRA","code":"BR","name":"БРАЗИЛИЯ","phoneInfo":{"prefix":"+55","minLength":10,"maxLength":10,"format":"+00 00 0000-0000"}},{"id":"IOT","code":"IO","name":"БРИТАНСКАЯ ТЕРРИТОРИЯ В ИНДИЙСКОМ ОКЕАНЕ","phoneInfo":{"prefix":"+246","minLength":7,"maxLength":7,"format":"+000 000 0000"}},{"id":"VGB","code":"VG","name":"БРИТАНСКИЕ ВИРГИНСКИЕ ОСТРОВА","phoneInfo":{"prefix":"+1","extendedPrefix":"284","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"BRN","code":"BN","name":"БРУНЕЙ","phoneInfo":{"prefix":"+673","minLength":7,"maxLength":7,"format":"+000 000 0000"}},{"id":"BVT","code":"BV","name":"БУВЕ","phoneInfo":{"prefix":"+47","minLength":8,"maxLength":8,"format":"+00 000 00 000"}},{"id":"BFA","code":"BF","name":"БУРКИНА ФАСО","phoneInfo":{"prefix":"+226","minLength":8,"maxLength":8,"format":"+000 00 00 00 00"}},{"id":"BDI","code":"BI","name":"БУРУНДИ","phoneInfo":{"prefix":"+257","minLength":8,"maxLength":8,"format":"+000 00 00 00 00"}},{"id":"BTN","code":"BT","name":"БУТАН","phoneInfo":{"prefix":"+975","minLength":8,"maxLength":8,"format":"+000 00 00 00 00"}},{"id":"VUT","code":"VU","name":"ВАНУАТУ","phoneInfo":{"prefix":"+678","minLength":7,"maxLength":7,"format":"+000 000 0000"}},{"id":"VAT","code":"VA","name":"ВАТИКАН"},{"id":"GBR","code":"GB","name":"ВЕЛИКОБРИТАНИЯ","phoneInfo":{"prefix":"+44","minLength":10,"maxLength":10,"format":"+00 0000 000000"}},{"id":"HUN","code":"HU","name":"ВЕНГРИЯ","phoneInfo":{"prefix":"+36","minLength":9,"maxLength":9,"format":"+00 00 000 0000"}},{"id":"VEN","code":"VE","name":"ВЕНЕСУЭЛА","phoneInfo":{"prefix":"+58","minLength":10,"maxLength":10,"format":"+00 000-0000000"}},{"id":"UMI","code":"UM","name":"ВНЕШНИЕ МАЛЫЕ ОСТРОВА США","phoneInfo":{"prefix":"+1","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"TLS","code":"TL","name":"ВОСТОЧНЫЙ ТИМОР","phoneInfo":{"prefix":"+670","minLength":8,"maxLength":8,"format":"+000 0000 0000"}},{"id":"VNM","code":"VN","name":"ВЬЕТНАМ","phoneInfo":{"prefix":"+84","minLength":7,"maxLength":11,"format":"+00 00 000 00 000"}},{"id":"GAB","code":"GA","name":"ГАБОН","phoneInfo":{"prefix":"+241","minLength":8,"maxLength":8,"format":"+000 00 00 00 00"}},{"id":"HTI","code":"HT","name":"ГАИТИ","phoneInfo":{"prefix":"+509","minLength":8,"maxLength":8,"format":"+000 00 00 0000"}},{"id":"GUY","code":"GY","name":"ГАЙАНА","phoneInfo":{"prefix":"+592","minLength":7,"maxLength":7,"format":"+000 000 0000"}},{"id":"GMB","code":"GM","name":"ГАМБИЯ","phoneInfo":{"prefix":"+220","minLength":7,"maxLength":7,"format":"+000 000 0000"}},{"id":"GHA","code":"GH","name":"ГАНА","phoneInfo":{"prefix":"+233","minLength":9,"maxLength":9,"format":"+000 00 000 0000"}},{"id":"GLP","code":"GP","name":"ГВАДЕЛУПА","phoneInfo":{"prefix":"+590","minLength":9,"maxLength":9,"format":"+000 000 00-0000"}},{"id":"GTM","code":"GT","name":"ГВАТЕМАЛА","phoneInfo":{"prefix":"+502","minLength":8,"maxLength":8,"format":"+000 0000 0000"}},{"id":"GIN","code":"GN","name":"ГВИНЕЯ","phoneInfo":{"prefix":"+224","minLength":8,"maxLength":8,"format":"+000 00 00 00 00"}},{"id":"GNB","code":"GW","name":"ГВИНЕЯ-БИСАУ","phoneInfo":{"prefix":"+245","minLength":7,"maxLength":7,"format":"+000 000 0000"}},{"id":"DEU","code":"DE","name":"ГЕРМАНИЯ","phoneInfo":{"prefix":"+49","minLength":10,"maxLength":11,"format":"+00 000 00000000"}},{"id":"GIB","code":"GI","name":"ГИБРАЛТАР","phoneInfo":{"prefix":"+350","minLength":8,"maxLength":8,"format":"+000 00000000"}},{"id":"HND","code":"HN","name":"ГОНДУРАС","phoneInfo":{"prefix":"+504","minLength":8,"maxLength":8,"format":"+000 0000-0000"}},{"id":"HKG","code":"HK","name":"ГОНКОНГ","phoneInfo":{"prefix":"+852","minLength":8,"maxLength":8,"format":"+000 0000 0000"}},{"id":"GRD","code":"GD","name":"ГРЕНАДА","phoneInfo":{"prefix":"+1","extendedPrefix":"473","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"GRL","code":"GL","name":"ГРЕНЛАНДИЯ","phoneInfo":{"prefix":"+299","minLength":6,"maxLength":6,"format":"+000 00 00 00"}},{"id":"GRC","code":"GR","name":"ГРЕЦИЯ","phoneInfo":{"prefix":"+30","minLength":10,"maxLength":10,"format":"+00 000 000 0000"}},{"id":"GUM","code":"GU","name":"ГУАМ","phoneInfo":{"prefix":"+1","extendedPrefix":"671","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"FAR","code":"FF","name":"ДАЛЬНЕЕ ЗАРУБЕЖЬЕ"},{"id":"DNK","code":"DK","name":"ДАНИЯ","phoneInfo":{"prefix":"+45","minLength":8,"maxLength":8,"format":"+00 00 00 00 00"}},{"id":"COD","code":"CD","name":"ДЕМОКРАТИЧЕСКАЯ РЕСПУБЛИКА КОНГО","phoneInfo":{"prefix":"+243","minLength":9,"maxLength":9,"format":"+000 000 000 000"}},{"id":"DJI","code":"DJ","name":"ДЖИБУТИ","phoneInfo":{"prefix":"+253","minLength":8,"maxLength":8,"format":"+000 00 00 00 00"}},{"id":"DMA","code":"DM","name":"ДОМИНИКА","phoneInfo":{"prefix":"+1","extendedPrefix":"767","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"DOM","code":"DO","name":"ДОМИНИКАНСКАЯ РЕСПУБЛИКА","phoneInfo":{"prefix":"+1","extendedPrefix":"829,849,809","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"EGY","code":"EG","name":"ЕГИПЕТ","phoneInfo":{"prefix":"+20","minLength":10,"maxLength":10,"format":"+00 000 000 0000"}},{"id":"ZMB","code":"ZM","name":"ЗАМБИЯ","phoneInfo":{"prefix":"+260","minLength":9,"maxLength":9,"format":"+000 00 0000000"}},{"id":"ESH","code":"EH","name":"ЗАПАДНАЯ САХАРА","phoneInfo":{"prefix":"+212","minLength":9,"maxLength":9,"format":"+000 000-000000"}},{"id":"ZWE","code":"ZW","name":"ЗИМБАБВЕ","phoneInfo":{"prefix":"+263","minLength":9,"maxLength":9,"format":"+000 00 000 0000"}},{"id":"ISR","code":"IL","name":"ИЗРАИЛЬ","phoneInfo":{"prefix":"+972","minLength":8,"maxLength":9,"format":"+000 00-000-0000"}},{"id":"IND","code":"IN","name":"ИНДИЯ","phoneInfo":{"prefix":"+91","minLength":10,"maxLength":10,"format":"+00 00 00 000000"}},{"id":"IDN","code":"ID","name":"ИНДОНЕЗИЯ","phoneInfo":{"prefix":"+62","minLength":9,"maxLength":9,"format":"+00 000-000-000"}},{"id":"JOR","code":"JO","name":"ИОРДАНИЯ","phoneInfo":{"prefix":"+962","minLength":8,"maxLength":9,"format":"+000 0 0000 0000"}},{"id":"IRQ","code":"IQ","name":"ИРАК","phoneInfo":{"prefix":"+964","minLength":10,"maxLength":10,"format":"+000 000 000 0000"}},{"id":"IRN","code":"IR","name":"ИРАН","phoneInfo":{"prefix":"+98","minLength":10,"maxLength":10,"format":"+00 000 000 0000"}},{"id":"IRL","code":"IE","name":"ИРЛАНДИЯ","phoneInfo":{"prefix":"+353","minLength":9,"maxLength":9,"format":"+000 00 000 0000"}},{"id":"ISL","code":"IS","name":"ИСЛАНДИЯ","phoneInfo":{"prefix":"+354","minLength":7,"maxLength":7,"format":"+000 000 0000"}},{"id":"ESP","code":"ES","name":"ИСПАНИЯ","phoneInfo":{"prefix":"+34","minLength":9,"maxLength":9,"format":"+00 000 00 00 00"}},{"id":"ITA","code":"IT","name":"ИТАЛИЯ","phoneInfo":{"prefix":"+39","minLength":10,"maxLength":10,"format":"+00 000 000 0000"}},{"id":"YEM","code":"YE","name":"ЙЕМЕН","phoneInfo":{"prefix":"+967","minLength":9,"maxLength":9,"format":"+000 000 000 000"}},{"id":"CPV","code":"CV","name":"КАБО-ВЕРДЕ","phoneInfo":{"prefix":"+238","minLength":7,"maxLength":7,"format":"+000 000 00 00"}},{"id":"CYM","code":"KY","name":"КАЙМАНОВЫ ОСТРОВА","phoneInfo":{"prefix":"+1","extendedPrefix":"345","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"KHM","code":"KH","name":"КАМБОДЖА","phoneInfo":{"prefix":"+855","minLength":8,"maxLength":8,"format":"+000 00 000 000"}},{"id":"CMR","code":"CM","name":"КАМЕРУН","phoneInfo":{"prefix":"+237","minLength":8,"maxLength":8,"format":"+000 00 00 00 00"}},{"id":"CAN","code":"CA","name":"КАНАДА","phoneInfo":{"prefix":"+1","extendedPrefix":"204,250,289,306,403,416,418,450,506,514,519,604,613,647,705,709,778,780,807,819,867,902,905,204,250,289,306,403,416,418,450,506,514,519,604,613,647,705,709,778,780,807,819,867,902,905","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"QAT","code":"QA","name":"КАТАР","phoneInfo":{"prefix":"+974","minLength":8,"maxLength":8,"format":"+000 0000 0000"}},{"id":"KEN","code":"KE","name":"КЕНИЯ","phoneInfo":{"prefix":"+254","minLength":9,"maxLength":9,"format":"+000 000 000000"}},{"id":"CYP","code":"CY","name":"КИПР","phoneInfo":{"prefix":"+357","minLength":8,"maxLength":8,"format":"+000 00 000000"}},{"id":"KIR","code":"KI","name":"КИРИБАТИ","phoneInfo":{"prefix":"+686","minLength":5,"maxLength":5,"format":"+000 00000"}},{"id":"CHN","code":"CN","name":"КИТАЙ","phoneInfo":{"prefix":"+86","minLength":11,"maxLength":11,"format":"+00 000 0000 0000"}},{"id":"CCK","code":"CC","name":"КОКОСОВЫЕ  ОСТРОВА ","phoneInfo":{"prefix":"+61","minLength":9,"maxLength":9,"format":"+00 000 000 000"}},{"id":"COL","code":"CO","name":"КОЛУМБИЯ","phoneInfo":{"prefix":"+57","minLength":10,"maxLength":10,"format":"+00 000 0000000"}},{"id":"COM","code":"KM","name":"КОМОРСКИЕ ОСТРОВА","phoneInfo":{"prefix":"+269","minLength":7,"maxLength":7,"format":"+000 000 00 00"}},{"id":"COG","code":"CG","name":"КОНГО","phoneInfo":{"prefix":"+242","minLength":9,"maxLength":9,"format":"+000 00 000 0000"}},{"id":"KOR","code":"KR","name":"КОРЕЯ","phoneInfo":{"prefix":"+82","minLength":10,"maxLength":10,"format":"+00 00-0000-0000"}},{"id":"CRI","code":"CR","name":"КОСТА-РИКА","phoneInfo":{"prefix":"+506","minLength":8,"maxLength":8,"format":"+000 0000 0000"}},{"id":"CIV","code":"CI","name":"КОТ-ДИВУАР","phoneInfo":{"prefix":"+225","minLength":8,"maxLength":8,"format":"+000 00 00 00 00"}},{"id":"CUB","code":"CU","name":"КУБА","phoneInfo":{"prefix":"+53","minLength":8,"maxLength":8,"format":"+00 0 0000000"}},{"id":"KWT","code":"KW","name":"КУВЕЙТ","phoneInfo":{"prefix":"+965","minLength":8,"maxLength":8,"format":"+000 000 00000"}},{"id":"LAO","code":"LA","name":"ЛАОС","phoneInfo":{"prefix":"+856","minLength":10,"maxLength":10,"format":"+000 00 00 000 000"}},{"id":"LVA","code":"LV","name":"ЛАТВИЯ","phoneInfo":{"prefix":"+371","minLength":8,"maxLength":8,"format":"+000 00 000 000"}},{"id":"LSO","code":"LS","name":"ЛЕСОТО","phoneInfo":{"prefix":"+266","minLength":8,"maxLength":8,"format":"+000 0000 0000"}},{"id":"LBR","code":"LR","name":"ЛИБЕРИЯ","phoneInfo":{"prefix":"+231","minLength":7,"maxLength":7,"format":"+000 0 000 000"}},{"id":"LBN","code":"LB","name":"ЛИВАН","phoneInfo":{"prefix":"+961","minLength":8,"maxLength":8,"format":"+000 00 000 000"}},{"id":"LBY","code":"LY","name":"ЛИВИЯ","phoneInfo":{"prefix":"+218","minLength":9,"maxLength":9,"format":"+000 00-0000000"}},{"id":"LTU","code":"LT","name":"ЛИТВА","phoneInfo":{"prefix":"+370","minLength":8,"maxLength":8,"format":"+000 000 00000"}},{"id":"LIE","code":"LI","name":"ЛИХТЕНШТЕЙН","phoneInfo":{"prefix":"+423","minLength":9,"maxLength":9,"format":"+000 000 000 000"}},{"id":"LUX","code":"LU","name":"ЛЮКСЕМБУРГ","phoneInfo":{"prefix":"+352","minLength":9,"maxLength":9,"format":"+000 000 000 000"}},{"id":"MUS","code":"MU","name":"МАВРИКИЙ","phoneInfo":{"prefix":"+230","minLength":7,"maxLength":7,"format":"+000 000 0000"}},{"id":"MRT","code":"MR","name":"МАВРИТАНИЯ","phoneInfo":{"prefix":"+222","minLength":8,"maxLength":8,"format":"+000 00 00 00 00"}},{"id":"MDG","code":"MG","name":"МАДАГАСКАР","phoneInfo":{"prefix":"+261","minLength":9,"maxLength":9,"format":"+000 00 00 000 00"}},{"id":"MYT","code":"YT","name":"МАЙОТТА","phoneInfo":{"prefix":"+262","minLength":9,"maxLength":9,"format":"+000 000 00 00 00"}},{"id":"MAC","code":"MO","name":"МАКАО","phoneInfo":{"prefix":"+853","minLength":8,"maxLength":8,"format":"+000 0000 0000"}},{"id":"MKD","code":"MK","name":"МАКЕДОНИЯ","phoneInfo":{"prefix":"+389","minLength":8,"maxLength":8,"format":"+000 00 000 000"}},{"id":"MWI","code":"MW","name":"МАЛАВИ","phoneInfo":{"prefix":"+265","minLength":9,"maxLength":9,"format":"+000 000 00 00 00"}},{"id":"MYS","code":"MY","name":"МАЛАЙЗИЯ","phoneInfo":{"prefix":"+60","minLength":9,"maxLength":9,"format":"+00 00-000 0000"}},{"id":"MLI","code":"ML","name":"МАЛИ","phoneInfo":{"prefix":"+223","minLength":8,"maxLength":8,"format":"+000 00 00 00 00"}},{"id":"MLT","code":"MT","name":"МАЛЬТА","phoneInfo":{"prefix":"+356","minLength":8,"maxLength":8,"format":"+000 0000 0000"}},{"id":"MAR","code":"MA","name":"МАРОККО","phoneInfo":{"prefix":"+212","minLength":9,"maxLength":9,"format":"+000 000-000000"}},{"id":"MTQ","code":"MQ","name":"МАРТИНИКА","phoneInfo":{"prefix":"+596","minLength":9,"maxLength":9,"format":"+000 000 00 00 00"}},{"id":"MHL","code":"MH","name":"МАРШАЛЛОВЫ ОСТРОВА","phoneInfo":{"prefix":"+692","minLength":7,"maxLength":7,"format":"+000 000-0000"}},{"id":"MEX","code":"MX","name":"МЕКСИКА","phoneInfo":{"prefix":"+52","minLength":11,"maxLength":11,"format":"+00 0 000 000 0000"}},{"id":"MOZ","code":"MZ","name":"МОЗАМБИК","phoneInfo":{"prefix":"+258","minLength":9,"maxLength":9,"format":"+000 00 000 0000"}},{"id":"MCO","code":"MC","name":"МОНАКО","phoneInfo":{"prefix":"+377","minLength":9,"maxLength":9,"format":"+000 0 00 00 00 00"}},{"id":"MNG","code":"MN","name":"МОНГОЛИЯ","phoneInfo":{"prefix":"+976","minLength":8,"maxLength":8,"format":"+000 0000 0000"}},{"id":"MSR","code":"MS","name":"МОНТСЕРРАТ","phoneInfo":{"prefix":"+1","extendedPrefix":"664","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"NAM","code":"NA","name":"НАМИБИЯ","phoneInfo":{"prefix":"+264","minLength":9,"maxLength":9,"format":"+000 00 000 0000"}},{"id":"NRU","code":"NR","name":"НАУРУ","phoneInfo":{"prefix":"+674","minLength":7,"maxLength":7,"format":"+000 000 0000"}},{"id":"NPL","code":"NP","name":"НЕПАЛ","phoneInfo":{"prefix":"+977","minLength":8,"maxLength":10,"format":"+000 000-0000000"}},{"id":"NER","code":"NE","name":"НИГЕР","phoneInfo":{"prefix":"+227","minLength":8,"maxLength":8,"format":"+000 00 00 00 00"}},{"id":"NGA","code":"NG","name":"НИГЕРИЯ","phoneInfo":{"prefix":"+234","minLength":10,"maxLength":10,"format":"+000 000 000 0000"}},{"id":"NLD","code":"NL","name":"НИДЕРЛАНДЫ","phoneInfo":{"prefix":"+31","minLength":9,"maxLength":9,"format":"+00 0 00000000"}},{"id":"NIC","code":"NI","name":"НИКАРАГУА","phoneInfo":{"prefix":"+505","minLength":8,"maxLength":8,"format":"+000 0000 0000"}},{"id":"NIU","code":"NU","name":"НИУЭ","phoneInfo":{"prefix":"+683","minLength":4,"maxLength":4,"format":"+000 0000"}},{"id":"NZL","code":"NZ","name":"НОВАЯ ЗЕЛАНДИЯ","phoneInfo":{"prefix":"+64","minLength":9,"maxLength":9,"format":"+00 00 000 0000"}},{"id":"NCL","code":"NC","name":"НОВАЯ КАЛЕДОНИЯ","phoneInfo":{"prefix":"+687","minLength":6,"maxLength":6,"format":"+000 00.00.00"}},{"id":"NOR","code":"NO","name":"НОРВЕГИЯ","phoneInfo":{"prefix":"+47","minLength":8,"maxLength":8,"format":"+00 000 00 000"}},{"id":"NFK","code":"NF","name":"НОРФОЛК","phoneInfo":{"prefix":"+672","minLength":6,"maxLength":6,"format":"+000 0 00000"}},{"id":"ARE","code":"AE","name":"ОБЪЕДИНЕННЫЕ АРАБСКИЕ ЭМИРАТЫ","phoneInfo":{"prefix":"+971","minLength":9,"maxLength":9,"format":"+000 00 000 0000"}},{"id":"OMN","code":"OM","name":"ОМАН","phoneInfo":{"prefix":"+968","minLength":8,"maxLength":8,"format":"+000 0000 0000"}},{"id":"CXR","code":"CX","name":"ОСТРОВ РОЖДЕСТВА","phoneInfo":{"prefix":"+61","minLength":9,"maxLength":9,"format":"+00 000 000 000"}},{"id":"SHN","code":"SH","name":"ОСТРОВ СВЯТОЙ ЕЛЕНЫ ","phoneInfo":{"prefix":"+290","minLength":5,"maxLength":5,"format":"+000 00 000"}},{"id":"HMD","code":"HM","name":"ОСТРОВ ХЕРД И ОСТРОВА МАКДОНАЛД","phoneInfo":{"prefix":"+672","minLength":6,"maxLength":6,"format":"+000 0 00000"}},{"id":"COK","code":"CK","name":"ОСТРОВА КУКА","phoneInfo":{"prefix":"+682","minLength":5,"maxLength":5,"format":"+000 00 000"}},{"id":"PCN","code":"PN","name":"ОСТРОВА ПИТКЭРН","phoneInfo":{"prefix":"+64","minLength":8,"maxLength":8,"format":"+00 00 000000"}},{"id":"SJM","code":"SJ","name":"ОСТРОВА ШПИЦБЕРГЕН И ЯН-МАЙЕН","phoneInfo":{"prefix":"+47","minLength":8,"maxLength":8,"format":"+00 000 00 000"}},{"id":"PAK","code":"PK","name":"ПАКИСТАН","phoneInfo":{"prefix":"+92","minLength":10,"maxLength":10,"format":"+00 000 0000000"}},{"id":"PLW","code":"PW","name":"ПАЛАУ","phoneInfo":{"prefix":"+680","minLength":7,"maxLength":7,"format":"+000 000 0000"}},{"id":"PSE","code":"PS","name":"ПАЛЕСТИНА ","phoneInfo":{"prefix":"+970","minLength":9,"maxLength":9,"format":"+000 000 000 000"}},{"id":"PAN","code":"PA","name":"ПАНАМА","phoneInfo":{"prefix":"+507","minLength":8,"maxLength":8,"format":"+000 0000-0000"}},{"id":"PNG","code":"PG","name":"ПАПУА НОВАЯ ГВИНЕЯ","phoneInfo":{"prefix":"+675","minLength":7,"maxLength":7,"format":"+000 000 0000"}},{"id":"PRY","code":"PY","name":"ПАРАГВАЙ","phoneInfo":{"prefix":"+595","minLength":9,"maxLength":9,"format":"+000 000 000000"}},{"id":"PER","code":"PE","name":"ПЕРУ","phoneInfo":{"prefix":"+51","minLength":9,"maxLength":9,"format":"+00 000 000 000"}},{"id":"POL","code":"PL","name":"ПОЛЬША","phoneInfo":{"prefix":"+48","minLength":9,"maxLength":9,"format":"+00 000 000 000"}},{"id":"PRT","code":"PT","name":"ПОРТУГАЛИЯ","phoneInfo":{"prefix":"+351","minLength":9,"maxLength":9,"format":"+000 000 000 000"}},{"id":"PRI","code":"PR","name":"ПУЭРТО-РИКО","phoneInfo":{"prefix":"+1","extendedPrefix":"787","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"SYC","code":"SC","name":"РЕСПУБЛИКА СЕЙШЕЛЬСКИЕ ОСТРОВА ","phoneInfo":{"prefix":"+248","minLength":7,"maxLength":7,"format":"+000 0 000 000"}},{"id":"REU","code":"RE","name":"РЕЮНЬОН","phoneInfo":{"prefix":"+262","minLength":9,"maxLength":9,"format":"+000 000 00 00 00"}},{"id":"RWA","code":"RW","name":"РУАНДА","phoneInfo":{"prefix":"+250","minLength":9,"maxLength":9,"format":"+000 000 000 000"}},{"id":"ROU","code":"RO","name":"РУМЫНИЯ","phoneInfo":{"prefix":"+40","minLength":9,"maxLength":9,"format":"+00 000 000 000"}},{"id":"SLV","code":"SV","name":"САЛЬВАДОР","phoneInfo":{"prefix":"+503","minLength":8,"maxLength":8,"format":"+000 0000 0000"}},{"id":"WSM","code":"WS","name":"САМОА","phoneInfo":{"prefix":"+685","minLength":6,"maxLength":6,"format":"+000 000000"}},{"id":"SMR","code":"SM","name":"САН-МАРИНО","phoneInfo":{"prefix":"+378","minLength":8,"maxLength":8,"format":"+000 00 00 00 00"}},{"id":"STP","code":"ST","name":"САН-ТОМЕ И ПРИНСИПИ","phoneInfo":{"prefix":"+239","minLength":7,"maxLength":7,"format":"+000 000 0000"}},{"id":"SAU","code":"SA","name":"САУДОВСКАЯ АРАВИЯ","phoneInfo":{"prefix":"+966","minLength":9,"maxLength":9,"format":"+000 00 000 0000"}},{"id":"SWZ","code":"SZ","name":"СВАЗИЛЕНД","phoneInfo":{"prefix":"+268","minLength":8,"maxLength":8,"format":"+000 0000 0000"}},{"id":"MNP","code":"MP","name":"СЕВЕРНЫЕ МАРИАНСКИЕ ОСТРОВА","phoneInfo":{"prefix":"+1","extendedPrefix":"670","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"SPM","code":"PM","name":"СЕН-ПЬЕР И МИКЕЛОН","phoneInfo":{"prefix":"+508","minLength":6,"maxLength":6,"format":"+000 00 00 00"}},{"id":"SEN","code":"SN","name":"СЕНЕГАЛ","phoneInfo":{"prefix":"+221","minLength":9,"maxLength":9,"format":"+000 00 000 00 00"}},{"id":"VCT","code":"VC","name":"СЕНТ-ВИНСЕНТ И ГРЕНАДИНЫ","phoneInfo":{"prefix":"+1","extendedPrefix":"784","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"KNA","code":"KN","name":"СЕНТ-КИТТС И НЕВИС","phoneInfo":{"prefix":"+1","extendedPrefix":"869","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"LCA","code":"LC","name":"СЕНТ-ЛЮСИЯ","phoneInfo":{"prefix":"+1","extendedPrefix":"758","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"SRB","code":"RS","name":"СЕРБИЯ","phoneInfo":{"prefix":"+381","minLength":9,"maxLength":9,"format":"+000 00 0000000"}},{"id":"SGP","code":"SG","name":"СИНГАПУР","phoneInfo":{"prefix":"+65","minLength":8,"maxLength":8,"format":"+00 0000 0000"}},{"id":"SYR","code":"SY","name":"СИРИЯ","phoneInfo":{"prefix":"+963","minLength":9,"maxLength":9,"format":"+000 000 000 000"}},{"id":"SVK","code":"SK","name":"СЛОВАКИЯ","phoneInfo":{"prefix":"+421","minLength":9,"maxLength":9,"format":"+000 000 000 000"}},{"id":"SVN","code":"SI","name":"СЛОВЕНИЯ","phoneInfo":{"prefix":"+386","minLength":8,"maxLength":8,"format":"+000 00 000 000"}},{"id":"SLB","code":"SB","name":"СОЛОМОНОВЫ ОСТРОВА","phoneInfo":{"prefix":"+677","minLength":7,"maxLength":7,"format":"+000 000 0000"}},{"id":"SOM","code":"SO","name":"СОМАЛИ","phoneInfo":{"prefix":"+252","minLength":8,"maxLength":8,"format":"+000 00 000000"}},{"id":"SDN","code":"SD","name":"СУДАН","phoneInfo":{"prefix":"+249","minLength":9,"maxLength":9,"format":"+000 00 000 0000"}},{"id":"SUR","code":"SR","name":"СУРИНАМ","phoneInfo":{"prefix":"+597","minLength":7,"maxLength":7,"format":"+000 000-0000"}},{"id":"USA","code":"US","name":"США","phoneInfo":{"prefix":"+1","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"SLE","code":"SL","name":"СЬЕРРА-ЛЕОНЕ","phoneInfo":{"prefix":"+232","minLength":8,"maxLength":8,"format":"+000 00 000000"}},{"id":"TCA","code":"TC","name":"ТЁРКС И КАЙКОС","phoneInfo":{"prefix":"+1","extendedPrefix":"649","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"THA","code":"TH","name":"ТАИЛАНД","phoneInfo":{"prefix":"+66","minLength":9,"maxLength":9,"format":"+00 00 000 0000"}},{"id":"TWN","code":"TW","name":"ТАЙВАНЬ","phoneInfo":{"prefix":"+886","minLength":9,"maxLength":9,"format":"+000 000 000 000"}},{"id":"TZA","code":"TZ","name":"ТАНЗАНИЯ","phoneInfo":{"prefix":"+255","minLength":9,"maxLength":9,"format":"+000 000 000 000"}},{"id":"TGO","code":"TG","name":"ТОГО","phoneInfo":{"prefix":"+228","minLength":8,"maxLength":8,"format":"+000 00 00 00 00"}},{"id":"TKL","code":"TK","name":"ТОКЕЛАУ","phoneInfo":{"prefix":"+690","minLength":4,"maxLength":4,"format":"+000 0000"}},{"id":"TON","code":"TO","name":"ТОНГА","phoneInfo":{"prefix":"+676","minLength":7,"maxLength":7,"format":"+000 000 0000"}},{"id":"TTO","code":"TT","name":"ТРИНИДАД И ТОБАГО","phoneInfo":{"prefix":"+1","extendedPrefix":"868","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"TUV","code":"TV","name":"ТУВАЛУ","phoneInfo":{"prefix":"+688","minLength":6,"maxLength":6,"format":"+000 000000"}},{"id":"TUN","code":"TN","name":"ТУНИС","phoneInfo":{"prefix":"+216","minLength":8,"maxLength":8,"format":"+000 00 000 000"}},{"id":"TKM","code":"TM","name":"ТУРКМЕНИЯ","phoneInfo":{"prefix":"+993","minLength":8,"maxLength":8,"format":"+000 00 000000"}},{"id":"UGA","code":"UG","name":"УГАНДА","phoneInfo":{"prefix":"+256","minLength":9,"maxLength":9,"format":"+000 000 000000"}},{"id":"UKR","code":"UA","name":"УКРАИНА","phoneInfo":{"prefix":"+380","minLength":9,"maxLength":9,"format":"+000 00 000 0000"}},{"id":"WLF","code":"WF","name":"УОЛЛИС И ФУТУНА","phoneInfo":{"prefix":"+681","minLength":6,"maxLength":6,"format":"+000 00 00 00"}},{"id":"URY","code":"UY","name":"УРУГВАЙ","phoneInfo":{"prefix":"+598","minLength":8,"maxLength":8,"format":"+000 00 000 000"}},{"id":"FRO","code":"FO","name":"ФАРЕРСКИЕ ОСТРОВА","phoneInfo":{"prefix":"+298","minLength":6,"maxLength":6,"format":"+000 000000"}},{"id":"FSM","code":"FM","name":"ФЕДЕРАТИВНЫЕ ШТАТЫ МИКРОНЕЗИИ","phoneInfo":{"prefix":"+691","minLength":7,"maxLength":7,"format":"+000 000 0000"}},{"id":"FJI","code":"FJ","name":"ФИДЖИ","phoneInfo":{"prefix":"+679","minLength":7,"maxLength":7,"format":"+000 000 0000"}},{"id":"PHL","code":"PH","name":"ФИЛИППИНЫ","phoneInfo":{"prefix":"+63","minLength":10,"maxLength":10,"format":"+00 000 000 0000"}},{"id":"FIN","code":"FI","name":"ФИНЛЯНДИЯ","phoneInfo":{"prefix":"+358","minLength":9,"maxLength":9,"format":"+000 00 0000000"}},{"id":"FLK","code":"FK","name":"ФОЛКЛЕНДСКИЕ ОСТРОВА","phoneInfo":{"prefix":"+500","minLength":5,"maxLength":5,"format":"+000 00000"}},{"id":"FRA","code":"FR","name":"ФРАНЦИЯ","phoneInfo":{"prefix":"+33","minLength":9,"maxLength":9,"format":"+00 0 00 00 00 00"}},{"id":"GUF","code":"GF","name":"ФРАНЦУЗСКАЯ ГВИАНА","phoneInfo":{"prefix":"+594","minLength":9,"maxLength":9,"format":"+000 000 00 00 00"}},{"id":"PYF","code":"PF","name":"ФРАНЦУЗСКАЯ ПОЛИНЕЗИЯ","phoneInfo":{"prefix":"+689","minLength":6,"maxLength":6,"format":"+000 00 00 00"}},{"id":"ATF","code":"TF","name":"ФРАНЦУЗСКИЕ ЮЖНЫЕ И АНТАРКТИЧЕСКИЕ ТЕРРИТОРИИ","phoneInfo":{"prefix":"+262","minLength":9,"maxLength":9,"format":"+000 000 00 00 00"}},{"id":"HRV","code":"HR","name":"ХОРВАТИЯ","phoneInfo":{"prefix":"+385","minLength":9,"maxLength":9,"format":"+000 00 000 0000"}},{"id":"CAF","code":"CF","name":"ЦЕНТРАЛЬНОАФРИКАНСКАЯ РЕСПУБЛИКА","phoneInfo":{"prefix":"+236","minLength":8,"maxLength":8,"format":"+000 00 00 00 00"}},{"id":"TCD","code":"TD","name":"ЧАД","phoneInfo":{"prefix":"+235","minLength":8,"maxLength":8,"format":"+000 00 00 00 00"}},{"id":"MNE","code":"ME","name":"ЧЕРНОГОРИЯ","phoneInfo":{"prefix":"+382","minLength":8,"maxLength":8,"format":"+000 00 000 000"}},{"id":"CZE","code":"CZ","name":"ЧЕХИЯ","phoneInfo":{"prefix":"+420","minLength":9,"maxLength":9,"format":"+000 000 000 000"}},{"id":"CHL","code":"CL","name":"ЧИЛИ","phoneInfo":{"prefix":"+56","minLength":9,"maxLength":9,"format":"+00 0 0000 0000"}},{"id":"CHE","code":"CH","name":"ШВЕЙЦАРИЯ","phoneInfo":{"prefix":"+41","minLength":9,"maxLength":9,"format":"+00 00 000 00 00"}},{"id":"SWE","code":"SE","name":"ШВЕЦИЯ","phoneInfo":{"prefix":"+46","minLength":9,"maxLength":9,"format":"+00 00 000 00 00"}},{"id":"LKA","code":"LK","name":"ШРИ-ЛАНКА","phoneInfo":{"prefix":"+94","minLength":9,"maxLength":9,"format":"+00 00 000 0000"}},{"id":"ECU","code":"EC","name":"ЭКВАДОР","phoneInfo":{"prefix":"+593","minLength":9,"maxLength":9,"format":"+000 00 000 0000"}},{"id":"GNQ","code":"GQ","name":"ЭКВАТОРИАЛЬНАЯ ГВИНЕЯ","phoneInfo":{"prefix":"+240","minLength":9,"maxLength":9,"format":"+000 000 000 000"}},{"id":"ERI","code":"ER","name":"ЭРИТРЕЯ","phoneInfo":{"prefix":"+291","minLength":7,"maxLength":7,"format":"+000 0 000 000"}},{"id":"EST","code":"EE","name":"ЭСТОНИЯ","phoneInfo":{"prefix":"+372","minLength":7,"maxLength":8,"format":"+000 0000 0000"}},{"id":"ETH","code":"ET","name":"ЭФИОПИЯ","phoneInfo":{"prefix":"+251","minLength":9,"maxLength":9,"format":"+000 00 000 0000"}},{"id":"ZAF","code":"ZA","name":"ЮАР","phoneInfo":{"prefix":"+27","minLength":9,"maxLength":9,"format":"+00 00 000 0000"}},{"id":"SGS","code":"GS","name":"ЮЖНАЯ ГЕОРГИЯ И ЮЖНЫЕ САНДВИЧЕВЫ ОСТРОВА"},{"id":"SSD","code":"SS","name":"ЮЖНЫЙ СУДАН","phoneInfo":{"prefix":"+211","minLength":9,"maxLength":9,"format":"+000 000 000 000"}},{"id":"JAM","code":"JM","name":"ЯМАЙКА","phoneInfo":{"prefix":"+1","extendedPrefix":"876","minLength":10,"maxLength":10,"format":"+0 000-000-0000"}},{"id":"JPN","code":"JP","name":"ЯПОНИЯ","phoneInfo":{"prefix":"+81","minLength":10,"maxLength":10,"format":"+00 00-0000-0000"}}],
            currentCountry: defaultCountry,
            value: '',
        }
    }

    handleSelectChange = e => {
        let currentCountry = _.find(this.state.countries, function(o) { return o.id === e;});
        let value = '';
        this.state.value.replace(/\s+/g, '').length >= currentCountry.phoneInfo.prefix.length
            ?
            value = _.replace(this.state.value, this.state.currentCountry.phoneInfo.prefix, currentCountry.phoneInfo.prefix)
            :
            value = currentCountry.phoneInfo.prefix;

        this.setState({currentCountry,value})
    };

    handleInputChange = e => {
        let valuePrefix = e.target.value.substr(0,this.state.currentCountry.phoneInfo.prefix.length).replace(/\s+/g, '');

        if(valuePrefix !== this.state.currentCountry.phoneInfo.prefix){
            let currentCountry =
                _.find(this.state.countries, function(o) {
                    if (o.hasOwnProperty('phoneInfo')) {
                        return o.phoneInfo.prefix === valuePrefix;
                    }
                })
                ||
                defaultCountry;
            console.log(currentCountry);
            this.setState({currentCountry});
        }

        this.setState({
            value: e.target.value
        })
    };

    render() {
        if(this.props.countries_loading) return null;
        return (
            <InputGroup compact>
                <Select value={this.state.currentCountry.id} onChange={this.handleSelectChange}>
                    {this.state.countries.map((item,index)=>{
                        return (
                            <Option value={item.id} key={index}>
                                <Flag
                                    code={item.code}
                                    fallback={ <img src={require('../internet.svg')} height='20'/> }
                                    height="16"
                                    width="16"
                                />
                                {item.name}
                            </Option>)
                    })}
                    <Option value={defaultCountry.id}>
                        <Flag
                            code={defaultCountry.code}
                            fallback={ <img src={require('../Flag_-_Unknown.png')} height='20'/> }
                            height="16"
                            width="16"
                        />
                        {defaultCountry.name}
                    </Option>
                </Select>
                <InputMask
                    mask={this.state.value !== '' ? this.state.currentCountry.phoneInfo.format : defaultCountry.phoneInfo.format}
                    value={this.state.value}
                    formatChars={{'0': '[0-9]'}}
                    alwaysShowMask={false}
                    maskChar=''
                    disabled={false}
                    onChange={this.handleInputChange}
                >
                    { (inputProps) => <Input style={{width:200}}/> }
                </InputMask>
            </InputGroup>
        );
    }

    componentDidMount() {
        this.props.dispatch(getCountries())
    }
}

function mapStateToProps(state) {
    return {
        countries: state.countries.countries,
        countries_loading: state.countries.is_loading,
    };
}

export default connect(
    mapStateToProps
)(PhoneInput);
